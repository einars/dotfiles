#!/usr/bin/env bash

function usage() {

    self="${0##*/}"

    echo "Usage: $self [fast|slow|dark|normal]"
    echo "Do various stuff to nvidia card."
    echo
    echo "    fast     - set PowerMizer to max. performance"
    echo "    slow     - set PowerMizer to adaptive mode"
    echo
    echo "    dark     - turn screen into a dark mode"
    echo "    normal   - turn screen normal"
    echo
}

case "$1" in
    fast)
        # 1 = max performance
        echo "Going fast, turning PowerMizer to max performance"
        nvidia-settings -a "[gpu]/GPUPowerMizerMode=1" \
            >/dev/null
        ;;
    slow)
        # 0 = adaptive
        echo "Going slow, turning PowerMizer to adaptive"
        nvidia-settings -a "[gpu]/GPUPowerMizerMode=0" \
            >/dev/null
        ;;
    dark)
        echo "Going dark"

        nvidia-settings \
            -a ":0[DPY:DVI-D-0]/RedBrightness=-1.000000" \
            -a ":0[DPY:DVI-D-0]/GreenBrightness=-1.000000" \
            -a ":0[DPY:DVI-D-0]/BlueBrightness=-1.000000" \
            -a ":0[DPY:DVI-D-0]/RedContrast=-1.000000" \
            -a ":0[DPY:DVI-D-0]/GreenContrast=-1.000000" \
            -a ":0[DPY:DVI-D-0]/BlueContrast=-1.000000" \
            > /dev/null

        nvidia-settings \
            -a ":0[DPY:HDMI-0]/RedBrightness=-1.000000" \
            -a ":0[DPY:HDMI-0]/GreenBrightness=-1.000000" \
            -a ":0[DPY:HDMI-0]/BlueBrightness=-1.000000" \
            -a ":0[DPY:HDMI-0]/RedContrast=-1.000000" \
            -a ":0[DPY:HDMI-0]/GreenContrast=-1.000000" \
            -a ":0[DPY:HDMI-0]/BlueContrast=-1.000000" \
            > /dev/null
        ;;
    normal)
        echo "Going normal"

        nvidia-settings \
            -a ":0[DPY:DVI-D-0]/RedBrightness=0.000000" \
            -a ":0[DPY:DVI-D-0]/GreenBrightness=0.000000" \
            -a ":0[DPY:DVI-D-0]/BlueBrightness=0.000000" \
            -a ":0[DPY:DVI-D-0]/RedContrast=0.000000" \
            -a ":0[DPY:DVI-D-0]/GreenContrast=0.000000" \
            -a ":0[DPY:DVI-D-0]/BlueContrast=0.000000" \
            > /dev/null

        nvidia-settings \
            -a ":0[DPY:HDMI-0]/RedBrightness=0.000000" \
            -a ":0[DPY:HDMI-0]/GreenBrightness=0.000000" \
            -a ":0[DPY:HDMI-0]/BlueBrightness=0.000000" \
            -a ":0[DPY:HDMI-0]/RedContrast=0.000000" \
            -a ":0[DPY:HDMI-0]/GreenContrast=0.000000" \
            -a ":0[DPY:HDMI-0]/BlueContrast=0.000000" \
            > /dev/null
        ;;
    *)
        usage
        exit 1
        ;;
esac
