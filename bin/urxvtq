#!/usr/bin/bash

classname=urxvt-terminal

# parallel execution/frequent switching sometimes fails with
#  X Error of failed request:  BadWindow (invalid Window parameter)
#  Major opcode of failed request:  3 (X_GetWindowAttributes)
wid=failed
until echo $wid | grep -v failed; do
  wid=$(xdotool search --classname $classname 2>&1)
done
if [ -z "$wid" ]; then
  exec urxvt -name urxvt-terminal -geometry 199x40 -e tmux-attach-or-create global &
  sleep 0.05
  xdotool search --classname $classname windowactivate
else
  # multiple windows? take first
  wid=$(echo $wid | awk '{print $1}')
  if [ -z "$(xdotool search --onlyvisible --classname $classname)" ]; then
    xdotool windowmap $wid --sync
    xdotool windowactivate $wid --sync
  else
    xdotool windowunmap $wid
  fi
fi
