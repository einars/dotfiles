#!/bin/sh

set_lv()
{
  setxkbmap lv -option caps:ctrl_modifier
}

set_ru()
{
  setxkbmap ru -variant phonetic_dvorak
}

fix_iso()
{
  echo '
!! fix ISO layout dumbnesses
! backslash to left shift pip, and make small button near enter an additional enter
keycode 94 = backslash bar backslash bar grave breve grave breve
  ' | xmodmap -
}

set_lv_custom()
{
        setxkbmap lv_custom -variant dvp -option caps:ctrl_modifier

        fix_iso

        echo '
! clear Lock
! keycode 0x42 = Escape

!!! keycode 51 = Return
! altgr , = ×□
keycode 59 = w W w W multiply U25A1
! altgr . = ·■
keycode 60 = v V w W periodcentered U25A0
        ' | xmodmap -
}

layout=$(setxkbmap -query | grep layout | awk '{print $2}')

set_auto()
{
  case $layout in
    lv_custom)
      set_lv
      ;;
    ru)
      set_lv_custom
      ;;
    *)
      set_lv_custom
      ;;
  esac
}

if [ "$1" != ""  ]; then
  if [ "$1" == "$layout" ]; then
    set_lv_custom # set back lv dvorak
  else
    set_$1
  fi
else
  set_auto
fi

#xset r rate 200 30
xset r rate 400 15

layout-notify
