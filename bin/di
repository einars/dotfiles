#!/usr/bin/env bash

STYLES_DI=(exposurenyc trance vocaltrance electro chillout eurodance house soulfulhouse funkyhouse tribalhouse harddance minimal techno progressive goapsy hardstyle hardcore djmixes lounge drumandbass classictechno ambient breaks futuresynthpop gabber)
STYLES_SKY=(christmas tophits classical datempolounge newage world guitar solopiano smoothjazz uptemposmoothjazz urbanjamz rootsreggae the80s hit70s classicrock altrock oldies classicrap pianojazz bossanova country lovemusic beatles indierock soundtracks christian jazz salsa)

N_DI=${#STYLES_DI[@]}
N_SKY=${#STYLES_SKY[@]}

E_NOARGS=66
E_BADARG=67

echo Di.fm stations wrapper for mplayer.
echo

if [ "$1" == "" ]
then
    echo "Usage: di <genre>" ;
    echo Di.fm stations:
    index=0
    while [ "$index" -lt "$N_DI" ]
    do
        if [ $index -ne 0 ]; then
            echo -n ', '
        fi
        echo -n ${STYLES_DI[$index]}
        let "index = $index + 1"
    done

    echo
    echo
    echo Sky.fm stations:
    index=0
    while [ "$index" -lt "$N_SKY" ]
    do
        if [ $index -ne 0 ]; then
            echo -n ', '
        fi
        echo -n ${STYLES_SKY[$index]}
        let "index = $index + 1"
    done

    echo

    exit $E_NOARGS
fi

if [ `echo "$1" | grep http` ]; then
    MEDIA_URL=$1
else
    MEDIA_URL=

    index=0
    while [ "$index" -lt "$N_DI" ]
    do
        if [ ${STYLES_DI[$index]} == "$1" ]; then
            if [ "$2" == "-aac" ]; then
                MEDIA_URL=http://www.di.fm/aacplus/$1.pls
            else
                MEDIA_URL=http://www.di.fm/mp3/$1.pls
            fi

        fi
        let "index = $index + 1"
    done

    index=0
    while [ "$index" -lt "$N_SKY" ]
    do
        if [ ${STYLES_SKY[$index]} == "$1" ]; then
            if [ "$2" == "-aac" ]; then
                MEDIA_URL=http://www.sky.fm/aacplus/$1.pls
            else
                MEDIA_URL=http://www.sky.fm/mp3/$1.pls
            fi
        fi
        let "index = $index + 1"
    done
    if [ "$MEDIA_URL" == "" ]; then
        echo Unknown station \"$1\".
        exit $E_BADARG
    fi
fi

echo $MEDIA_URL
MEDIA_URL=`curl --fail "$MEDIA_URL" 2>/dev/null | grep File | cut -b 7-`
echo $MEDIA_URL
killall -q mplayer
mplayer $MEDIA_URL
